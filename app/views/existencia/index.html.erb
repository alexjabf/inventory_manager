<%quantity = []%>
<% x= 0 %>
<% @top_ten.each do |existencium| %>
  <%if existencium.IdArticulo == 108%>
    <%# quantity[x] = [existencium.Cantidad  + @sebo.Cantidad.to_i, "Merma"] %>
  <%else%>
    <% quantity[x] = [existencium.Cantidad, Articulo.find_by_idArticulo(existencium.IdArticulo).Descripcion.titlecase]%>
  <%end%>
  <%x = x + 1%>
<%end%>
<% quantity = quantity.sort_by{|k|-k[0]}%>
<%# quantity = quantity.sort{|a,b| b[0] <=> a[0]}%>
<%unless quantity[5].nil?%>
  <script type="text/javascript">
    $(function() {
      $('#graph-container').highcharts({
        chart: {
          renderTo: 'container',
          type: 'column'
        },
        title: {
          text: 'Existencias'
        },
        subtitle: {
          text: 'Almacén Producto Terminado'
        },
        xAxis: {
          categories: ['Productos Ordenados por mas Cantidad en Kg'
          ]
        },
        yAxis: {
          min: 0,
          title: {
            text: 'Cantidad en Kg'
          }
        },
        legend: {
          layout: 'vertical',
          backgroundColor: '#FFFFFF',
          align: 'left',
          verticalAlign: 'top',
          x: 800,
          y: 70,
          floating: true,
          shadow: true
        },
        tooltip: {
          formatter: function() {
            return '' +
                    this.x + ': ' + this.y + ' kg';
          }
        },
        plotOptions: {
          column: {
            pointPadding: 0.2,
            borderWidth: 0
          }
        },
        series: [{
            name: '<%=quantity[0].last%>',
            data: [<%=quantity[0].first%>]

          }, {
            name: '<%=quantity[1].last%>',
            data: [<%=quantity[1].first%>]

          }, {
            name: '<%=quantity[2].last%>',
            data: [<%=quantity[2].first%>]

          }, {
            name: '<%=quantity[3].last%>',
            data: [<%=quantity[3].first%>]

          }, {
            name: '<%=quantity[4].last%>',
            data: [<%=quantity[4].first%>]

          }, {
            name: '<%=quantity[5].last%>',
            data: [<%=quantity[5].first%>]

          }, {
            name: '<%=quantity[6].last%>',
            data: [<%=quantity[6].first%>]

          }, {
            name: '<%=quantity[7].last%>',
            data: [<%=quantity[7].first%>]

          }, {
            name: '<%=quantity[8].last%>',
            data: [<%=quantity[8].first%>]

          }, {
            name: '<%=quantity[9].last%>',
            data: [<%=quantity[9].first%>]

          }]
      });
    });
    $(document).ready(function() {
      $("#graph, #graph1").click(function() {
        $("#graph-container").fadeToggle("slow");
      });
    });
  </script>
<%end%>
<div class="page-header">
  <h3><%= "Existencias en Almacén Producto Terminado" %></h3>
</div>
<%= link_to image_tag("/assets/topten.jpg", :size => "60x60"), "#" , :id => "graph", :title => "Gráfica de Existencias (10 en mayor cantidad Kg)"%>  <%=link_to "Productos con más cantidad en almacén.", "#" , :id => "graph1"%>
<div id="graph-container" style="width: 1000px; height: 400px; margin-left: -40px"  data-theme="a"  hidden="true"></div>

<%= javascript_include_tag "highcharts", "exporting" %>
<div class="table-responsive" style="margin-top: 20px;">
  <table class="table table-bordered table-hover table-striped">
    <thead>
      <tr>
        <th><%= t('layouts.application.actions') %></th>
        <th><%= t'.id' %></th>
        <th><%= t'.IdExistencia' %></th>
        <th><%= t'.IdArticulo' %></th>
        <th><%= t'.IdAlmacen' %></th>
        <th><%= t'.Cantidad' %></th>
        <th><%= t'.Fecha' %></th>
        <th><%= t'.FechaCad' %></th>
      </tr>
    </thead>

    <tbody>
      <% @existencia.each do |existencium| %>


        <% @model = existencium %> 

        <tr>
          <td><%= render "partials/index_links" %></td>
          <%if can? :show, Existencium %>
            <td><%=link_to existencium.id, existencium, :class => "btn btn-xs btn-primary" %></td>
          <%else%>
            <td><%= label existencium.id, existencium.id, :class => "btn btn-xs btn-default", :disabled => true%></td>
          <%end%>
          <td><%= number_with_delimiter(existencium.IdExistencia, locale: session[:locale]) %></td>
          <td><%= number_with_delimiter(existencium.IdArticulo, locale: session[:locale]).to_s + " (" + Articulo.find_by_idArticulo(existencium.IdArticulo).Descripcion + ")" %></td>
          <td><%#= number_with_delimiter(existencium.IdAlmacen, locale: session[:locale]).to_s + " (" + Almacen.find_by_IdAlmacen(existencium.IdAlmacen).name + ")" %></td>
          <td><%#= number_with_delimiter(existencium.Cantidad, locale: session[:locale]) %></td>
          <td><%= existencium.Fecha %></td>
          <td><%= existencium.FechaCad %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>